function foo(a,b){var c=0;if(!window.console||b&&!c)return!1;(void 0===a||null===a)&&(a="o_O");var d=(new Date).toUTCString().split(" ")[4];"object"==typeof a?(console.log("["+d+"] object:"),console.dir(a)):console.log("["+d+"] "+a)}function shuffle(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}var cnsts={colors:["#cd8","#de9"],$score:$(".score"),$bubble:$(".bubble"),rowHeight:30,colWidth:60,rows:23,cols:7,topScore:1e20,game:{height:300,width:300},keys:{up:38,down:40,left:37,right:39},anims:{left:[60,120,60,60,120,120,60,60,60,120,60,60,0,120,60,60],down:[60,180,60,60,120,180,60,60,60,180,60,60,0,180,60,60],up:[60,60,60,60,120,60,60,60,60,60,60,60,0,60,60,60],right:[60,0,60,60,120,0,60,60,60,0,60,60,0,0,60,60]},money:{width:60,height:40,offsetY:-16,offsetX:-1},group:{offsetX:30,offsetY:15},dude:{width:60,height:60}},vars={direction:{"new":"down",changed:0},$controls:$(".controls a"),muted:!1,started:!1,paused:!0,score:0,tilesMoved:0,sinceMoney:0,money:[{x:1,y:8},{x:5,y:8},{x:5,y:16},{x:1,y:16}],spawn:{x:3,y:12},timeouts:{bubbleFade:0,scoreUpdate:0}},stage=new Konva.Stage({container:"canvas",width:cnsts.game.width,height:cnsts.game.height}),gameLayer=new Konva.Layer({x:0,y:0,clip:{x:0,y:0,width:cnsts.game.width,height:cnsts.game.height}});stage.add(gameLayer);var gameGroup=new Konva.Group({offsetX:30,offsetY:15}),dude=new Konva.Sprite,game={setup:function(){foo("game.setup",1),draw.tiles(),draw.dude(),draw.movement(),$('[data-game="start"]').text("start")},pause:function(){foo("game.pause",1),vars.paused=!0,sounds.mute()},unPause:function(){foo("game.unPause",1),vars.paused=!1,sounds.mute(),dude.start(),draw.next()},play:function(){foo("game.play",1),vars.paused=!1,sounds.begin.play(),setTimeout(function(){sounds.cat.play("loop")},500),sounds.footsteps.play(),dude.start(),draw.next()},xy:function(a){return foo("game.xy",1),"down"===vars.direction["new"]?(a.y-=1,a.x-=a.y%2):"up"===vars.direction["new"]?(a.x+=a.y%2,a.y+=1):"right"===vars.direction["new"]?(a.y+=1,a.x-=a.y%2):"left"===vars.direction["new"]&&(a.x+=a.y%2,a.y-=1),a}},draw={next:function(){foo("draw.next",1),draw.tiles(),draw.movement(),dude.setAnimation(vars.direction["new"])},tiles:function(){if(foo("draw.tiles",1),gameGroup.x(0),gameGroup.y(0),cnsts.colors.reverse(),vars.tilesMoved)for(var b=0;b<cnsts.rows;b++)for(var c=0;c<cnsts.cols;c++)gameLayer.find(".poly_"+b+"_"+c).fill(cnsts.colors[b%2]);else{for(var a=-cnsts.rowHeight,b=0;b<cnsts.rows;b++){a+=cnsts.rowHeight/2;for(var c=0;c<cnsts.cols;c++){var d=cnsts.colWidth*c+b%2*(cnsts.colWidth/2),e=new Konva.Line({points:[d,a,d+cnsts.colWidth/2,a+cnsts.rowHeight/2,d,a+cnsts.rowHeight,d-cnsts.colWidth/2,a+cnsts.rowHeight/2],name:"poly poly_"+b+"_"+c,fill:cnsts.colors[b%2],closed:!0,strokeWidth:2,stroke:"#bc7",perfectDrawEnabled:!1});gameGroup.add(e)}}gameLayer.add(gameGroup)}gameLayer.find(".poly_"+vars.spawn.y+"_"+vars.spawn.x).fill("#fff"),vars.tilesMoved>0&&(vars.spawn=game.xy(vars.spawn)),gameLayer.find(".money").remove();for(var f=!1,g=[],h=0;h<vars.money.length;h++){var i=gameLayer.find(".poly_"+vars.money[h].y+"_"+vars.money[h].x);if(i.length>0){g.push(i);var j=i[0].attrs.points[0]-cnsts.colWidth+Math.floor((cnsts.colWidth-cnsts.money.width)/2)+cnsts.money.offsetX+cnsts.group.offsetX,k=i[0].attrs.points[1]-cnsts.rowHeight/2+cnsts.money.offsetY+cnsts.group.offsetY,l=new Konva.Image({x:j,y:k,image:images["money"+(h+1)],width:cnsts.money.width,height:cnsts.money.height,opacity:1,name:"money"});gameGroup.add(l)}gameLayer.find(".poly_"+vars.money[h].y+"_"+(vars.money[h].x-1)).fill("#dea"),gameLayer.find(".poly_"+vars.money[h].y+"_"+(vars.money[h].x+1)).fill("#dea"),gameLayer.find(".poly_"+(vars.money[h].y+2)+"_"+vars.money[h].x).fill("#dea"),gameLayer.find(".poly_"+(vars.money[h].y-2)+"_"+vars.money[h].x).fill("#dea"),gameLayer.find(".poly_"+(vars.money[h].y-1)+"_"+(vars.money[h].x-(vars.money[h].y-1)%2)).fill("#efc"),gameLayer.find(".poly_"+(vars.money[h].y+1)+"_"+(vars.money[h].x+vars.money[h].y%2)).fill("#efc"),gameLayer.find(".poly_"+(vars.money[h].y+1)+"_"+(vars.money[h].x-(vars.money[h].y+1)%2)).fill("#efc"),gameLayer.find(".poly_"+(vars.money[h].y-1)+"_"+(vars.money[h].x+vars.money[h].y%2)).fill("#efc"),vars.tilesMoved>0&&(vars.money[h]=game.xy(vars.money[h]));var m=0,n=Math.ceil(cnsts.cols/2)-1,o=Math.ceil(cnsts.rows/2),p=h+1,q=0;if(vars.money[h].x===n&&vars.money[h].y===o&&(q=3),(vars.money[h].x-1===n&&vars.money[h].y===o||vars.money[h].x+1===n&&vars.money[h].y===o||vars.money[h].x===n&&vars.money[h].y-2===o||vars.money[h].x===n&&vars.money[h].y+2===o)&&(q=1),m=p*q,m>0){sounds.pickup.play(),vars.money[h].x=-1,vars.money[h].y=-1;var r=new Konva.Tween({node:l,y:k-10,duration:.25,opacity:0});r.play(),vars.score+=m,vars.score>cnsts.topScore&&(alert("YOU ARE BORN ANEW."),vars.score=0);var s='<span class="yellow">+ '+p+"</span>";q>1&&(s+='<span class="xp white">'+q+"x</span>"),draw.score(s),f="speech"}if(vars.money[h].x<-1||vars.money[h].y<-1||vars.money[h].x===cnsts.cols+1||vars.money[h].y===cnsts.rows+1){for(var t=0,u=0,v=0;1>v;v++){t=Math.floor(Math.random()*(cnsts.cols+1)),u=Math.floor(Math.random()*(cnsts.rows+1));for(var w=0;w<vars.money.length;w++)vars.money[w].x===t&&vars.money[w].y===u&&v--}vars.money[h].x=t,vars.money[h].y=u}}$.each(g,function(a,b){b.fill("#fff")}),"speech"!==f?(vars.sinceMoney++,10===vars.sinceMoney&&draw.bubble("thought")):draw.bubble("speech")},score:function(a){foo("draw.score",1);var b=1+vars.score/1e3;sounds.cat.rate(b),sounds.footsteps.rate(b),cnsts.$score.html(a),clearTimeout(vars.timeouts.scoreUpdate),vars.timeouts.scoreUpdate=setTimeout(function(){foo("draw.score.scoreUpdate",1),cnsts.$score.html('<span class="xp">XP</span>'+vars.score)},750)},dude:function(){foo("draw.dude",1),dude=new Konva.Sprite({x:cnsts.game.width/2-cnsts.dude.width/2,y:cnsts.game.height/2-cnsts.dude.height/2,image:images.dude,animation:vars.direction["new"],animations:cnsts.anims,frameRate:8,frameIndex:0}),gameLayer.add(dude)},movement:function(){foo("draw.movement",1),vars.tilesMoved++;var a=.4;vars.score<1500?a-=vars.score/5e3:a=.002;var b,c;vars.paused?(b=0,c=0):"down"===vars.direction["new"]?(b=-cnsts.colWidth/2,c=-cnsts.rowHeight/2):"up"===vars.direction["new"]?(b=cnsts.colWidth/2,c=cnsts.rowHeight/2):"right"===vars.direction["new"]?(b=-cnsts.colWidth/2,c=cnsts.rowHeight/2):"left"===vars.direction["new"]&&(b=cnsts.colWidth/2,c=-cnsts.rowHeight/2);var d=new Konva.Tween({node:gameGroup,duration:a,x:b,y:c,onFinish:function(){foo("draw.movement.onFinish",1),vars.paused?(dude.frameIndex(0),dude.stop()):draw.next()}});d.play()},bubble:function(a){foo("draw.bubble",1),clearTimeout(vars.timeouts.bubbleFade),vars.sinceMoney=0;var b;if("speech"===a){var c=messages.exclamations[0];b="<span>"+c+"!</span><br>"+messages.speeches[0].split("^").join("<span>")+"!</span>",messages.speeches.push(messages.speeches.shift()),messages.exclamations.push(messages.exclamations.shift())}else b=messages.thoughts[0],messages.thoughts.push(messages.thoughts.shift());cnsts.$bubble.html("<p>"+b+"</p>").attr("class",a).show(),vars.timeouts.bubbleFade=setTimeout(function(){foo("draw.bubble.bubbleFade",1),cnsts.$bubble.removeClass(a).hide()},2e3)}},notLoaded=2,sounds={toLoad:4,begin:new Howl({src:["audio/begin.mp3","audio/begin.ogg"],volume:.5,onload:function(){foo("sounds.begin.onload",1),sounds.loaded()}}),footsteps:new Howl({src:["audio/footsteps.mp3","audio/footsteps.ogg"],loop:!0,volume:.2,onload:function(){foo("sounds.footsteps.onload",1),sounds.loaded()}}),pickup:new Howl({src:["audio/pickup.mp3","audio/pickup.ogg"],volume:.3,onload:function(){foo("sounds.pickup.onload",1),sounds.loaded()}}),cat:new Howl({src:["audio/cat.mp3","audio/cat.ogg"],loop:!0,volume:.4,sprite:{loop:[0,9950]},onload:function(){foo("sounds.cat.onload",1),sounds.loaded()}}),loaded:function(){foo("sounds.loaded",1),sounds.toLoad--,sounds.toLoad||(notLoaded--,notLoaded||game.setup())},mute:function(){foo("sounds.mute",1),vars.paused?Howler.mute(!0):Howler.mute(vars.muted)}},images={dude:"images/dude.png",money1:"images/money-1.png",money2:"images/money-2.png",money3:"images/money-3.png",money4:"images/money-4.png",speech1:"images/speech-top.png",speech2:"images/speech-bg.png",speech3:"images/speech-bottom.png",thought1:"images/thought-top.png",thought2:"images/thought-bg.png",thought3:"images/thought-bottom.png"};!function(){foo("iife.loadimages",1);var a=0;$.each(images,function(b,c){if("string"!=typeof c)return!1;a++;var d=new Image;d.src=c,d.onload=function(){foo("iife.loadimages."+b,1),images[b]=d,a--,a||(notLoaded--,notLoaded||game.setup())}})}(),$.modal.defaults.closeText="*",$.modal.defaults.fadeDuration=150;var page={windowChange:function(){foo("page.windowChange",1);var a=$.scrollify.current().attr("id");"undefined"!=typeof ga&&ga("send","pageview",location.pathname+"#"+a),vars.started&&("gameSection"===a&&vars.paused?game.unPause():vars.paused||game.pause())},toggleControls:function(){foo("page.toggleControls",1),vars.$controls.removeClass("active").filter('[id="'+vars.direction["new"]+'"]').addClass("active")}};$.scrollify({after:function(){foo("scrollify.after",1),page.windowChange()}}),$().ready(function(){$(window).on("focusin blur",function(a){"object"==typeof a.target.window&&"blur"===a.type?game.pause():vars.paused&&page.windowChange()}),vars.$controls.click(function(a){a.preventDefault(),vars.direction["new"]=$(this).attr("id"),page.toggleControls()}),$(".hi").on("click",function(a){a.preventDefault(),$(this).find(".one").remove()}),$('[data-game="start"]').on("click",function(a){a.preventDefault();var b=$(this);b.closest(".content").find(".off").removeClass("off"),b.parent().remove(),vars.started=!0,game.play()}),$('[data-game="mute"]').on("click",function(a){a.preventDefault(),$(this).toggleClass("active"),vars.muted=!vars.muted,sounds.mute()}),$('[rel="external"]').on("click",function(){return window.open(this.href),!1}),$.each($("[data-file]"),function(a,b){var c=$(b);c.attr("src",c.attr("data-file"))}),$("html").keydown(function(a){var b=a.keyCode,c=vars.direction["new"];switch(b){case cnsts.keys.up:a.preventDefault(),vars.direction["new"]="up";break;case cnsts.keys.down:a.preventDefault(),vars.direction["new"]="down";break;case cnsts.keys.left:a.preventDefault(),vars.direction["new"]="left";break;case cnsts.keys.right:a.preventDefault(),vars.direction["new"]="right"}c!==vars.direction["new"]&&(vars.direction.changed=!0,toggleControls())}),$.scrollify.update()});